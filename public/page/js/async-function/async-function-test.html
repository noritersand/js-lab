<!DOCTYPE html>
<html lang="ko">
<head>
<title>async function</title>
<meta charset="utf-8">
<link rel="icon" type="image/png" href="/image/favicon.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/style.css"/>
<script src="/lib/js/jquery-1.12.4.js"></script>
</head>
<body>
<div class="align-center">
  <h1>async function</h1>
  <p></p>
  <button type="button" onclick="getSome('/success.data?a=1&b=2&c=3')">성공 버튼</button>
  <button type="button" onclick="getSome('/error500.data?a=1&b=2&c=3')">실패 버튼</button>
  <p class="description"><strong>result1:</strong><br><br><span id="result1"></span></p>
  <p class="description"><strong>result2:</strong><br><br><span id="result2"></span></p>
</div>
<script>


function run(url) {
  return new Promise((resolve, reject) => {
    var xhr = new XMLHttpRequest();
    xhr.onload = () => {
      console.log('xhr:', xhr);
      if (xhr.status === 200) {
        resolve(xhr.responseText);
      } else {
        reject(new Error(xhr.responseText));
      }
    }
    xhr.onerror = () => {
      console.log('xhr:', xhr);
      reject(new Error(xhr.responseText));
    }
    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4) {
        
      }
    };
    xhr.open('get', url);
    xhr.send();
  });
}
function getSome(url) {
  run(url).then((respText) => {
    document.querySelector('#result1').innerHTML = respText;
  }).catch((respText) => {
    document.querySelector('#result2').innerHTML = respText;
  });
}
</script>
</body>
</html>
