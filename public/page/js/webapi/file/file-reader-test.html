<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>FileReader</title>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/image/favicon.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/css/style.css" />
    <script type="module" src="/js/fire-when-ready.js"></script>
  </head>
  <body>
    <div class="align-center">
      <h1>FileReader</h1>
      <div id="toc"></div>
      <p><button type="button" onclick="location.href = '/'">INDEX로 돌아가기</button></p>

      <section>
        <h2>FileReader로 첨부된 파일 읽기</h2>
        <input type="file" onchange="handleFileChange(event)" />
        <div class="description">
          <p>file input에 첨부된 파일 객체를 FileReader API를 이용해 data URI scheme 형식의 값으로 읽기</p>
        </div>
        <script>
          var actualResponse;

          function handleFileChange(e) {
            let files = e.target.files;
            console.log("files: ", files);

            let file = e.target.files[0];
            if (!file) {
              return;
            }
            console.log('file.type: ', file.type);

            var reader = new FileReader();
            reader.addEventListener("loadend", (e) => {
              actualResponse = e.target.result;
              console.log("actualResponse: ", actualResponse);
            });
            reader.readAsDataURL(file);
          }
        </script>
      </section>

      <section>
        <h2>FileReader로 읽어온 값을 이미지 태그 src 속성에 할당하기</h2>
        <div style="width: 200px; height: 100px; border: 1px solid black">
          <img src alt="이미지 태그 자리" style="width: 100%; height: 100%" />
        </div>
        <div>
          <button type="button" onclick="setImageSrc()">이미지 할당하기(파일 첨부를 먼저 할 것)</button>
        </div>
        <script>
          function setImageSrc() {
            document.querySelector("img").src = actualResponse;
          }
        </script>
        <div class="description">
          <p>만약 첨부한 파일이 이미지인 경우 이 Data URI scheme 값을 그대로 이미지 태그에 사용할 수 있다.</p>
        </div>
      </section>

      <section>
        <h2>FormData로 전송하기</h2>
        <div>
          <button type="button" onclick="sendFormData()">전송(파일 첨부를 먼저 할 것)</button>
        </div>
        <script>
          function sendFormData() {
            let formData = new FormData();
            formData.append("file", actualResponse);
            console.log("formData:", formData);

            fetch("/get-my-request-body.data", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.text())
              .then((data) => console.log(data))
              .catch((error) => console.error(error));
          }
        </script>
        <div class="description">
          <p>읽어온 값은 FormData를 활용, multipart/form-data 컨텐츠 타입으로 서버에 전송할 수 있음.</p>
        </div>
      </section>
    </div>
  </body>
</html>
